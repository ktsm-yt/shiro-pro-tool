<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>城プロ編成ツール</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1>🏯 城プロ編成ツール</h1>

        <div class="tabs">
            <button class="tab active" data-tab="characters">キャラクター管理</button>
            <button class="tab" data-tab="formation">編成作成</button>
            <button class="tab" data-tab="comparison">編成比較</button>
            <button class="tab" data-tab="simpleDamage">ダメージ計算</button>
            <button class="tab" data-tab="damage">ダメージ計算(β)</button>
        </div>

        <div id="characters" class="tab-content active">
            <h2>キャラクター管理</h2>

            <!-- Wiki URLインポート -->
            <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="margin-top: 0;">📋 Wiki URLからインポート</h3>
                <p style="font-size: 14px; color: #666; margin-bottom: 15px;">
                    城プロWikiのキャラクターページURLを貼り付けると、基本情報を自動入力できます
                </p>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text"
                           id="wikiURL"
                           placeholder="例: https://scre.swiki.jp/index.php?［絢爛］ダノター城"
                           style="flex: 1; padding: 10px; border: 2px solid #3498db; border-radius: 5px; font-size: 14px;">
                    <button class="btn" onclick="fetchFromWikiURL()" style="background: #3498db; padding: 10px 20px; white-space: nowrap;">
                        URLから取得
                    </button>
                </div>
                <div id="wikiImportStatus" style="margin-top: 10px; font-size: 14px;"></div>
            </div>

            <div class="character-form">
                <h3 id="formTitle">新規キャラクター追加</h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>名前</label>
                        <input type="text" id="charName" placeholder="例：ドレッドノート">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>期間（オプション）</label>
                        <input type="text" id="charPeriod" placeholder="例：嫁、暁星">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>武器種</label>
                        <input type="text" id="charWeapon" placeholder="例：軍船">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>遠近</label>
                        <div class="button-group" style="margin-bottom: 0;">
                            <button type="button" class="select-button compact" data-group="weaponRange" data-value="遠">遠</button>
                            <button type="button" class="select-button compact" data-group="weaponRange" data-value="近">近</button>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>物術</label>
                        <div class="button-group" style="margin-bottom: 0;">
                            <button type="button" class="select-button compact" data-group="weaponType" data-value="物">物</button>
                            <button type="button" class="select-button compact" data-group="weaponType" data-value="術">術</button>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>属性（複数選択可）</label>
                        <div class="button-group" style="margin-bottom: 0;">
                            <button type="button" class="select-button compact multi-select" data-group="attribute" data-value="水">水</button>
                            <button type="button" class="select-button compact multi-select" data-group="attribute" data-value="平">平</button>
                            <button type="button" class="select-button compact multi-select" data-group="attribute" data-value="山">山</button>
                            <button type="button" class="select-button compact multi-select" data-group="attribute" data-value="平山">平山</button>
                            <button type="button" class="select-button compact multi-select" data-group="attribute" data-value="地獄">地獄</button>
                            <button type="button" class="select-button compact multi-select" data-group="attribute" data-value="無属性">無属性</button>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>配置</label>
                        <div class="button-group" style="margin-bottom: 0;">
                            <button type="button" class="select-button compact" data-group="placement" data-value="遠">遠</button>
                            <button type="button" class="select-button compact" data-group="placement" data-value="近">近</button>
                            <button type="button" class="select-button compact" data-group="placement" data-value="遠近">遠近</button>
                        </div>
                    </div>
                </div>

                <!-- 編成特技入力 -->
                <div class="form-group">
                    <label class="collapsible-label" onclick="toggleCollapsible(this)">編成特技</label>
                    <div class="collapsible-content">
                        <div class="buff-input-area">
                        <div class="button-group">
                            <label>対象</label>
                            <button type="button" class="select-button" data-group="formationTarget" data-value="味方全員">味方全員</button>
                            <button type="button" class="select-button" data-group="formationTarget" data-value="味方軍船">味方軍船</button>
                            <button type="button" class="select-button" data-group="formationTarget" data-value="味方水城">味方水城</button>
                        </div>
                        <div class="button-group">
                            <label>バフ種</label>
                            <!-- 気 -->
                            <button type="button" class="select-button" data-group="formationType" data-value="気">気</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="耐久">耐久</button>
                            <!-- 計略 -->
                            <button type="button" class="select-button" data-group="formationType" data-value="計略短縮">計略短縮</button>
                            <!-- 攻撃 -->
                            <button type="button" class="select-button" data-group="formationType" data-value="攻撃固定">攻撃固定</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="攻撃割合">攻撃割合</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="防御無視">防御無視</button>
                            <!-- 防御 -->
                            <button type="button" class="select-button" data-group="formationType" data-value="防御固定">防御固定</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="防御割合">防御割合</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="回復">回復</button>
                            <!-- 速度 -->
                            <button type="button" class="select-button" data-group="formationType" data-value="速度">速度</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="隙">隙</button>
                            <!-- 移動 -->
                            <button type="button" class="select-button" data-group="formationType" data-value="移動変更">移動変更</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="移動低下">移動低下</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="移動停止">移動停止</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="移動後退">移動後退</button>
                            <!-- 射程 -->
                            <button type="button" class="select-button" data-group="formationType" data-value="射程固定">射程固定</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="射程割合">射程割合</button>
                            <button type="button" class="select-button" data-group="formationType" data-value="対象数">対象数</button>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="number" id="formationValue" placeholder="数値" style="width: 80px;">
                            <select id="formationUnit" style="width: 80px;">
                                <option value="+%">+%</option>
                                <option value="-%">-%</option>
                                <option value="+">+</option>
                                <option value="-">-</option>
                            </select>
                            <input type="text" id="formationCondition" placeholder="条件（オプション）" style="flex: 1;">
                            <button class="btn" onclick="addFormationBuff()" style="padding: 8px 15px;">追加</button>
                        </div>
                        <div id="formationsList" class="buffs-list"></div>
                        </div>
                    </div>
                </div>

                <!-- 特技入力 -->
                <div class="form-group">
                    <label>特技</label>
                    <div class="buff-input-area">
                        <div class="target-selector">
                            <label>対象</label>
                            <div class="button-group target-base-group">
                                <button type="button" class="select-button" data-group="skillTargetBase" data-value="自身">自身</button>
                                <button type="button" class="select-button" data-group="skillTargetBase" data-value="射程内">射程内</button>
                                <button type="button" class="select-button" data-group="skillTargetBase" data-value="全">全</button>
                            </div>
                            <div class="button-group target-modifier-group">
                                <label>追加条件（複数選択可）</label>
                                <button type="button" class="select-button multi-select" data-group="skillTargetModifier" data-value="味方">味方</button>
                                <button type="button" class="select-button multi-select" data-group="skillTargetModifier" data-value="伏兵">伏兵</button>
                                <button type="button" class="select-button multi-select" data-group="skillTargetModifier" data-value="殿">殿</button>
                                <button type="button" class="select-button multi-select" data-group="skillTargetModifier" data-value="水">水</button>
                                <button type="button" class="select-button multi-select" data-group="skillTargetModifier" data-value="平">平</button>
                                <button type="button" class="select-button multi-select" data-group="skillTargetModifier" data-value="山">山</button>
                                <button type="button" class="select-button multi-select" data-group="skillTargetModifier" data-value="平山">平山</button>
                                <button type="button" class="select-button multi-select" data-group="skillTargetModifier" data-value="地獄">地獄</button>
                            </div>
                            <div class="custom-target-input">
                                <input type="text" id="skillTargetCustom" placeholder="カスタム条件（例：歌舞のみ、盾のみ）">
                            </div>
                            <p class="target-hint">※ 「味方・伏兵・殿・属性」が含まれる対象は編成画面で強調表示されます</p>
                        </div>
                        <div class="button-group">
                            <label>バフ種</label>
                            <!-- 気 -->
                            <button type="button" class="select-button" data-group="skillType" data-value="自然気">自然気</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="気(牛)">気(牛)</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="気(ノビ)">気(ノビ)</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="徐々気">徐々気</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="気軽減">気軽減</button>
                            <!-- 計略 -->
                            <button type="button" class="select-button" data-group="skillType" data-value="計略短縮">計略短縮</button>
                            <!-- 攻撃 -->
                            <button type="button" class="select-button" data-group="skillType" data-value="攻撃固定">攻撃固定</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="攻撃割合">攻撃割合</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="与ダメ">与ダメ</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="与えるダメージ">与えるダメージ</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="被ダメ">被ダメ</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="防御デバフ固定">防御デバフ固定</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="防御デバフ割合">防御デバフ割合</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="防御無視">防御無視</button>
                            <!-- 防御 -->
                            <button type="button" class="select-button" data-group="skillType" data-value="防御固定">防御固定</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="防御割合">防御割合</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="回復">回復</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="攻撃デバフ固定">攻撃デバフ固定</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="攻撃デバフ割合">攻撃デバフ割合</button>
                            <!-- 速度 -->
                            <button type="button" class="select-button" data-group="skillType" data-value="速度">速度</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="隙">隙</button>
                            <!-- 移動 -->
                            <button type="button" class="select-button" data-group="skillType" data-value="移動変更">移動変更</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="移動低下">移動低下</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="移動停止">移動停止</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="移動後退">移動後退</button>
                            <!-- 射程 -->
                            <button type="button" class="select-button" data-group="skillType" data-value="射程固定">射程固定</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="射程割合">射程割合</button>
                            <button type="button" class="select-button" data-group="skillType" data-value="対象数">対象数</button>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="number" id="skillValue" placeholder="数値" style="width: 80px;">
                            <select id="skillUnit" style="width: 80px;">
                                <option value="+%">+%</option>
                                <option value="-%">-%</option>
                                <option value="×">×</option>
                                <option value="+">+</option>
                                <option value="-">-</option>
                            </select>
                            <input type="text" id="skillCondition" placeholder="条件（オプション）" style="flex: 1;">
                            <label style="display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                                <input type="checkbox" id="skillDuplicate">
                                <span>重複</span>
                            </label>
                            <button class="btn" onclick="addSkillBuff()" style="padding: 8px 15px;">追加</button>
                        </div>
                        <div id="skillsList" class="buffs-list"></div>
                    </div>
                </div>

                <!-- Wiki特技参照表示 -->
                <div id="wikiSkillsDisplay" style="margin-bottom: 20px;"></div>

                <!-- 計略入力 -->
                <div class="form-group">
                    <label>計略</label>
                    <div class="buff-input-area">
                        <div class="target-selector">
                            <label>対象</label>
                            <div class="button-group target-base-group">
                                <button type="button" class="select-button" data-group="strategyTargetBase" data-value="自身">自身</button>
                                <button type="button" class="select-button" data-group="strategyTargetBase" data-value="射程内">射程内</button>
                                <button type="button" class="select-button" data-group="strategyTargetBase" data-value="全">全</button>
                            </div>
                            <div class="button-group target-modifier-group">
                                <label>追加条件（複数選択可）</label>
                                <button type="button" class="select-button multi-select" data-group="strategyTargetModifier" data-value="味方">味方</button>
                                <button type="button" class="select-button multi-select" data-group="strategyTargetModifier" data-value="伏兵">伏兵</button>
                                <button type="button" class="select-button multi-select" data-group="strategyTargetModifier" data-value="殿">殿</button>
                                <button type="button" class="select-button multi-select" data-group="strategyTargetModifier" data-value="水">水</button>
                                <button type="button" class="select-button multi-select" data-group="strategyTargetModifier" data-value="平">平</button>
                                <button type="button" class="select-button multi-select" data-group="strategyTargetModifier" data-value="山">山</button>
                                <button type="button" class="select-button multi-select" data-group="strategyTargetModifier" data-value="平山">平山</button>
                                <button type="button" class="select-button multi-select" data-group="strategyTargetModifier" data-value="地獄">地獄</button>
                            </div>
                            <div class="custom-target-input">
                                <input type="text" id="strategyTargetCustom" placeholder="カスタム条件（例：伏兵の射程内、歌舞のみ）">
                            </div>
                            <p class="target-hint">※ 「味方・伏兵・殿・属性」が含まれる対象は編成画面で強調表示されます</p>
                        </div>
                        <div class="button-group">
                            <label>バフ種</label>
                            <!-- 気 -->
                            <button type="button" class="select-button" data-group="strategyType" data-value="自然気">自然気</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="気(牛)">気(牛)</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="気(ノビ)">気(ノビ)</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="徐々気">徐々気</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="気軽減">気軽減</button>
                            <!-- 計略 -->
                            <button type="button" class="select-button" data-group="strategyType" data-value="計略短縮">計略短縮</button>
                            <!-- 攻撃 -->
                            <button type="button" class="select-button" data-group="strategyType" data-value="攻撃固定">攻撃固定</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="攻撃割合">攻撃割合</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="与ダメ">与ダメ</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="与えるダメージ">与えるダメージ</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="被ダメ">被ダメ</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="防御デバフ固定">防御デバフ固定</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="防御デバフ割合">防御デバフ割合</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="防御無視">防御無視</button>
                            <!-- 防御 -->
                            <button type="button" class="select-button" data-group="strategyType" data-value="防御固定">防御固定</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="防御割合">防御割合</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="回復">回復</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="攻撃デバフ固定">攻撃デバフ固定</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="攻撃デバフ割合">攻撃デバフ割合</button>
                            <!-- 速度 -->
                            <button type="button" class="select-button" data-group="strategyType" data-value="速度">速度</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="隙">隙</button>
                            <!-- 移動 -->
                            <button type="button" class="select-button" data-group="strategyType" data-value="移動変更">移動変更</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="移動低下">移動低下</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="移動停止">移動停止</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="移動後退">移動後退</button>
                            <!-- 射程 -->
                            <button type="button" class="select-button" data-group="strategyType" data-value="射程固定">射程固定</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="射程割合">射程割合</button>
                            <button type="button" class="select-button" data-group="strategyType" data-value="対象数">対象数</button>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="number" id="strategyValue" placeholder="数値" style="width: 80px;">
                            <select id="strategyUnit" style="width: 80px;">
                                <option value="+%">+%</option>
                                <option value="-%">-%</option>
                                <option value="×">×</option>
                                <option value="+">+</option>
                                <option value="-">-</option>
                            </select>
                            <input type="text" id="strategyCondition" placeholder="条件（オプション）" style="flex: 1;">
                            <label style="display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                                <input type="checkbox" id="strategyDuplicate">
                                <span>重複</span>
                            </label>
                            <button class="btn" onclick="addStrategyBuff()" style="padding: 8px 15px;">追加</button>
                        </div>
                        <div id="strategiesList" class="buffs-list"></div>
                    </div>
                </div>

                <!-- Wiki計略参照表示 -->
                <div id="wikiStrategiesDisplay" style="margin-bottom: 20px;"></div>

                <button class="btn" id="submitBtn" onclick="submitCharacter()">キャラクター追加</button>
                <button class="btn" id="cancelEditBtn" onclick="cancelEdit()" style="background: #95a5a6; display: none; margin-left: 10px;">キャンセル</button>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                <h3>データ管理</h3>
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="exportCharacters()" style="background: #43e97b;">
                        キャラクターデータをエクスポート
                    </button>
                    <button class="btn" onclick="importCharacters()" style="background: #4facfe;">
                        キャラクターデータをインポート
                    </button>
                    <button class="btn" onclick="exportFormations()" style="background: #fd79a8;">
                        編成データをエクスポート
                    </button>
                    <button class="btn" onclick="importFormations()" style="background: #f093fb;">
                        編成データをインポート
                    </button>
                    <button class="btn" onclick="exportAllData()" style="background: #667eea;">
                        全データをエクスポート
                    </button>
                </div>
                <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileSelect(event)">
                <p style="margin-top: 10px; font-size: 12px; color: #666;">
                    ※ エクスポートしたデータはJSON形式でダウンロードされます<br>
                    ※ インポートは既存データに追加されます（IDが重複する場合は上書き）
                </p>
            </div>

            <h3>キャラクター一覧</h3>
            <div class="character-grid" id="characterGrid"></div>
        </div>

        <div id="formation" class="tab-content">
            <h2>編成作成</h2>

            <div class="character-selection">
                <h3>キャラクター選択（クリックで追加・削除）</h3>
                <div class="button-group" style="margin-bottom: 10px;">
                    <label>属性フィルター（複数選択可）</label>
                    <button type="button" class="select-button multi-select active" data-group="attributeFilter" data-value="すべて" onclick="toggleAttributeFilter(this)">すべて</button>
                    <button type="button" class="select-button multi-select" data-group="attributeFilter" data-value="水" onclick="toggleAttributeFilter(this)">水</button>
                    <button type="button" class="select-button multi-select" data-group="attributeFilter" data-value="平" onclick="toggleAttributeFilter(this)">平</button>
                    <button type="button" class="select-button multi-select" data-group="attributeFilter" data-value="山" onclick="toggleAttributeFilter(this)">山</button>
                    <button type="button" class="select-button multi-select" data-group="attributeFilter" data-value="地獄" onclick="toggleAttributeFilter(this)">地獄</button>
                    <button type="button" class="select-button multi-select" data-group="attributeFilter" data-value="無属性" onclick="toggleAttributeFilter(this)">無属性</button>
                </div>
                <div class="button-group" style="margin-bottom: 15px;">
                    <label>バフ種別フィルター（複数選択可）</label>
                    <button type="button" class="select-button multi-select active" data-group="categoryFilter" data-value="すべて" onclick="toggleCategoryFilter(this)">すべて</button>
                    <button type="button" class="select-button multi-select" data-group="categoryFilter" data-value="気管理" onclick="toggleCategoryFilter(this)">気管理</button>
                    <button type="button" class="select-button multi-select" data-group="categoryFilter" data-value="計略" onclick="toggleCategoryFilter(this)">計略</button>
                    <button type="button" class="select-button multi-select" data-group="categoryFilter" data-value="攻撃系" onclick="toggleCategoryFilter(this)">攻撃系</button>
                    <button type="button" class="select-button multi-select" data-group="categoryFilter" data-value="防御系" onclick="toggleCategoryFilter(this)">防御系</button>
                    <button type="button" class="select-button multi-select" data-group="categoryFilter" data-value="速度" onclick="toggleCategoryFilter(this)">速度</button>
                    <button type="button" class="select-button multi-select" data-group="categoryFilter" data-value="移動速度" onclick="toggleCategoryFilter(this)">移動速度</button>
                    <button type="button" class="select-button multi-select" data-group="categoryFilter" data-value="射程" onclick="toggleCategoryFilter(this)">射程</button>
                </div>
                <div class="character-grid compact-grid" id="availableCharacters"></div>
            </div>

            <div class="chart-section">
                <h3>編成バフ/デバフ強度</h3>
                <div class="bar-chart" id="barChart"></div>
            </div>

            <div class="formation-section">
                <h3>編成メンバー（<span id="memberCount">0</span>/8）</h3>
                <div id="formationStats" class="formation-stats"></div>
                <div class="formation-grid" id="formationGrid">
                    <div class="formation-slot empty" data-slot="0">空き</div>
                    <div class="formation-slot empty" data-slot="1">空き</div>
                    <div class="formation-slot empty" data-slot="2">空き</div>
                    <div class="formation-slot empty" data-slot="3">空き</div>
                    <div class="formation-slot empty" data-slot="4">空き</div>
                    <div class="formation-slot empty" data-slot="5">空き</div>
                    <div class="formation-slot empty" data-slot="6">空き</div>
                    <div class="formation-slot empty" data-slot="7">空き</div>
                </div>
                <div class="formation-actions">
                    <input type="text" id="formationName" placeholder="編成名を入力" />
                    <button class="btn" onclick="saveFormation()">編成を保存</button>
                    <button class="btn" onclick="clearFormation()" style="background: #ff4757;">編成をクリア</button>
                </div>
            </div>

            <div class="saved-formations">
                <h3>保存した編成</h3>
                <div id="savedFormationsList"></div>
            </div>
        </div>

        <div id="comparison" class="tab-content">
            <h2>編成比較</h2>

            <div class="comparison-section">
                <h3>比較する編成を選択</h3>
                <div id="formationSelector"></div>
            </div>

            <div class="comparison-chart-section">
                <h3>バフ/デバフ強度比較</h3>
                <div id="comparisonChart"></div>
            </div>
        </div>

        <div id="simpleDamage" class="tab-content">
            <div class="simple-damage-header">
                <div>
                    <h2>簡易ダメージ計算</h2>
                    <p style="color: #666; margin-bottom: 0;">行を組み合わせてシンプルにダメージを見積もることができます。複数の計算セットを並べて比較できます。</p>
                </div>
                <div class="simple-damage-header-right">
                    <div class="simple-damage-global-actions">
                        <button type="button" class="btn simple-damage-toggle-all" onclick="expandAllSimpleDamageEditors()">全て開く</button>
                        <button type="button" class="btn simple-damage-toggle-all" onclick="collapseAllSimpleDamageEditors()">全て閉じる</button>
                    </div>
                    <div class="simple-damage-global-settings">
                        <label>
                            敵防御力
                            <input type="number" inputmode="decimal" id="globalEnemyDefenseInput" value="0" oninput="handleGlobalEnemyDefenseInput(event)">
                        </label>
                        <label>
                            受け取る鼓舞（固定値）
                            <input type="number" step="0.01" inputmode="decimal" id="globalInspireSelfInput" value="0" oninput="handleGlobalInspireInput('self', event)">
                        </label>
                        <label>
                            味方へ配る鼓舞（固定値）
                            <input type="number" step="0.01" inputmode="decimal" id="globalInspireOthersInput" value="0" oninput="handleGlobalInspireInput('others', event)">
                        </label>
                    </div>
                </div>
            </div>

            <div id="simpleDamageProfiles" class="simple-damage-profiles" ondragover="handleProfileDragOver(event)" ondrop="handleProfileDrop(event)"></div>

            <div class="simple-damage-editors" id="simpleDamageEditorsContainer"></div>
        </div>

        <div id="damage" class="tab-content">
            <h2>ダメージ計算(β)</h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <!-- 左側: キャラクター選択 -->
                <div>
                    <h3>キャラクター選択</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold;">キャラクター検索</label>
                        <input type="text" id="damageCharacterSearch" placeholder="名前や武器種で検索" oninput="updateDamageCharacterSearch(this.value)" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                        <div id="damageCharacterList" style="display: grid; gap: 8px; max-height: 320px; overflow-y: auto;"></div>
                    </div>

                    <div id="selectedCharacterForDamage" style="background: #e8f4f8; padding: 15px; border-radius: 10px;">
                        <p style="color: #666; text-align: center;">キャラクターを選択してください</p>
                    </div>
                </div>

                <!-- 右側: 敵設定 -->
                <div>
                    <h3>敵設定</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">敵の防御力</label>
                            <input type="number" id="enemyDefense" value="1000" min="0" oninput="calculateDamage()" style="width: 100%; padding: 8px;">
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">敵のHP残量 (%)</label>
                            <input type="range" id="enemyHP" min="0" max="100" value="100" oninput="updateEnemyHPDisplay(); calculateDamage();" style="width: 100%;">
                            <div style="text-align: center; margin-top: 5px; font-size: 18px; font-weight: bold;" id="enemyHPDisplay">100%</div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">城娘の耐久 (%)</label>
                            <input type="range" id="allyHP" min="0" max="100" value="100" oninput="updateAllyHPDisplay(); calculateDamage();" style="width: 100%;">
                            <div style="text-align: center; margin-top: 5px; font-size: 18px; font-weight: bold;" id="allyHPDisplay">100%</div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="strategyActive" onchange="calculateDamage()">
                                <span style="font-weight: bold;">計略発動中</span>
                            </label>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ヒット数 / 対象数</label>
                            <input type="number" id="hitCount" value="1" min="1" step="1" oninput="calculateDamage()" style="width: 100%; padding: 8px;">
                            <p style="font-size: 12px; color: #666; margin-top: 5px;">多段攻撃や同時攻撃数を反映したい場合に調整</p>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">基礎攻撃力（手動入力）</label>
                            <input type="number" id="baseAttackInput" value="5000" min="0" oninput="calculateDamage()" style="width: 100%; padding: 8px;">
                            <p style="font-size: 12px; color: #666; margin-top: 5px;">※ 将来的にはキャラクターデータから自動取得予定</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="damageConditionControls" style="background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px dashed #ddd;">
                <h3 style="margin-top: 0;">条件付きバフ</h3>
                <p style="color: #666; font-size: 14px;">条件判定が自動で行えないバフはここに表示され、手動でON/OFFできます。</p>
                <div id="damageConditionList" style="display: grid; gap: 10px;"></div>
            </div>

            <!-- 計算結果 -->
            <div style="background: #f0f8ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3>計算結果</h3>
                <div id="damageResult" style="font-size: 16px;">
                    <p style="color: #666; text-align: center;">キャラクターを選択すると計算結果が表示されます</p>
                </div>
            </div>

            <!-- 計算内訳 -->
            <div style="background: #fff8e8; padding: 20px; border-radius: 10px;">
                <h3>計算内訳</h3>
                <div id="damageBreakdown" style="font-size: 14px; font-family: monospace;">
                    <p style="color: #666; text-align: center;">計算内訳はここに表示されます</p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
